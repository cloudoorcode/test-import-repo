"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.startRemoteProxies = startRemoteProxies;
const devkit_1 = require("@nx/devkit");
function startRemoteProxies(staticRemotesConfig, mappedLocationsOfRemotes) {
    const { createProxyMiddleware } = require('http-proxy-middleware');
    const express = require('express');
    devkit_1.logger.info(`NX Starting static remotes proxies...`);
    for (const app of staticRemotesConfig.remotes) {
        const expressProxy = express();
        expressProxy.use(createProxyMiddleware({
            target: mappedLocationsOfRemotes[app],
            changeOrigin: true,
        }));
        const proxyServer = expressProxy.listen(staticRemotesConfig.config[app].port);
        process.on('SIGTERM', () => proxyServer.close());
        process.on('exit', () => proxyServer.close());
    }
    devkit_1.logger.info(`NX Static remotes proxies started successfully`);
}
